<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Other Classes  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>

    <a name="//apple_ref/swift/Section/Other Classes" class="dashAnchor"></a>

    <a title="Other Classes  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          PenguinParallel Docs
        </a>
         (95% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/saeta/penguin">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">PenguinParallel Reference</a>
      <img class="carat" src="img/carat.png" />
      Other Classes  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Parallel.html">Parallel</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Array.html">Array</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other%20Classes.html">Other Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NonBlockingThreadPool.html">NonBlockingThreadPool</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NonblockingCondition.html">NonblockingCondition</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other%20Enums.html">Other Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/ComputeThreadPools.html">ComputeThreadPools</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other%20Protocols.html">Other Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/ComputeThreadPool.html">ComputeThreadPool</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/ConcurrencyPlatform.html">ConcurrencyPlatform</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/ConditionMutexProtocol.html">ConditionMutexProtocol</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/ConditionVariableProtocol.html">ConditionVariableProtocol</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/MutexProtocol.html">MutexProtocol</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/RawThreadLocalStorage.html">RawThreadLocalStorage</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/ThreadProtocol.html">ThreadProtocol</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other%20Structs.html">Other Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/InlineComputeThreadPool.html">InlineComputeThreadPool</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/PosixThreadLocalStorage.html">PosixThreadLocalStorage</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/PosixThreadLocalStorage.html#/s:15PenguinParallel21RawThreadLocalStorageP3KeyQa">– Key</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/TypedThreadLocalStorage.html">TypedThreadLocalStorage</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/TypedThreadLocalStorage/Key.html">– Key</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content top-matter">
            <h1>Other Classes</h1>
            <p>The following classes are available globally.</p>

          </div>
        </section>

        <section class="section">
          <div class="section-content">
            <div class="task-group">
              <ul class="item-container">
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:15PenguinParallel21NonBlockingThreadPoolC"></a>
                    <a name="//apple_ref/swift/Class/NonBlockingThreadPool" class="dashAnchor"></a>
                    <a class="token" href="#/s:15PenguinParallel21NonBlockingThreadPoolC">NonBlockingThreadPool</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>An efficient, work-stealing, general purpose compute thread pool.</p>

<p><code>NonBlockingThreadPool</code> can be cleaned up by calling <code>shutDown()</code> which will block until all
threads in the threadpool have exited. If <code>shutDown()</code> is never called, <code>NonBlockingThreadPool</code>
will never be deallocated.</p>

<p>NonBlockingThreadPool uses atomics to implement a non-blocking thread pool. During normal
execution, no locks are acquired or released. This can result in efficient parallelism across
many cores. <code>NonBlockingThreadPool</code> is designed to scale from laptops to high-core-count
servers. Although the thread pool size can be manually tuned, often the most efficient
configuration is a one-to-one mapping between hardware threads and worker threads, as this
allows full use of the hardware while avoiding unnecessary context switches. I/O heavy workloads
may want to reduce the thread pool count to dedicate a core or two to I/O processing.</p>

<p>Each thread managed by this thread pool maintains its own fixed-size pending task queue. The
workers loop, trying to get their next tasks from their own queue first, and if that queue is
empty, the worker tries to steal work from the pending task queues of other threads in the pool.</p>

<p><code>NonBlockingThreadPool</code> implements important optimizations based on the calling thread. There
are key fast-paths taken when calling functions on <code>NonBlockingThreadPool</code> from threads that
have been registered with the pool (or from threads managed by the pool itself). In order
to help users build performant applications, <code>NonBlockingThreadPool</code> will trap (and exit the
process) if functions are called on it from non-fast-path&rsquo;d threads by default. You can change
this behavior by setting <code>allowNonFastPathThreads: true</code> at initialization.</p>

<p>In order to avoid wasting excessive CPU cycles, the worker threads managed by
<code>NonBlockingThreadPool</code> will suspend themselves (using locks to inform the host kernel).
<code>NonBlockingThreadPool</code> is parameterized by an environment, which allows this thread pool to
seamlessly interoperate within a larger application by reusing its concurrency primitives (such
as locks and condition variables, which are used for thread parking), as well as even allowing
a custom thread allocator.</p>

<p>Local tasks typically execute in LIFO order, which is often optimal for cache locality of
compute intensive tasks. Other threads attempt to steal work &ldquo;FIFO&rdquo;-style, which admits an
efficient (dynamic) schedule for typical divide-and-conquor algorithms.</p>

<p>This implementation is inspired by the Eigen thread pool library, TFRT, as well as:</p>
<pre class="highlight swift"><code><span class="s">"Thread Scheduling for Multiprogrammed Multiprocessors"</span>
<span class="kt">Nimar</span> <span class="kt">S</span><span class="o">.</span> <span class="kt">Arora</span><span class="p">,</span> <span class="kt">Robert</span> <span class="kt">D</span><span class="o">.</span> <span class="kt">Blumofe</span><span class="p">,</span> <span class="kt">C</span><span class="o">.</span> <span class="kt">Greg</span> <span class="kt">Plaxton</span>
</code></pre>

                        <a href="Classes/NonBlockingThreadPool.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">class</span> <span class="kt">NonBlockingThreadPool</span><span class="o">&lt;</span><span class="kt">Environment</span><span class="o">&gt;</span> <span class="p">:</span> <span class="kt"><a href="Protocols/ComputeThreadPool.html">ComputeThreadPool</a></span> <span class="k">where</span> <span class="kt">Environment</span> <span class="p">:</span> <span class="kt"><a href="Protocols/ConcurrencyPlatform.html">ConcurrencyPlatform</a></span></code></pre>

                        </div>
                      </div>
                      <div class="slightly-smaller">
                        <a href="https://github.com/saeta/penguin/tree/master/Sources/PenguinParallel/NonblockingThreadPool/NonBlockingThreadPool.swift#L58-L350">Show on GitHub</a>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:15PenguinParallel20NonblockingConditionC"></a>
                    <a name="//apple_ref/swift/Class/NonblockingCondition" class="dashAnchor"></a>
                    <a class="token" href="#/s:15PenguinParallel20NonblockingConditionC">NonblockingCondition</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Allows to wait for arbitrary predicates in non-blocking algorithms.</p>

<p>You can think of <code>NonblockingCondition</code> as a condition variable, but the predicate to wait upon
does not need to be protected by a mutex. Using <code>NonblockingCondition</code> in a non-blocking
algorithm (instead of spinning) allows threads to go sleep, saving potentially significant
amounts of CPU resources.</p>

<p>To use <code>NonblockingCondition</code>, your algorithm should look like the following:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">nbc</span> <span class="o">=</span> <span class="kt">NonblockingCondition</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> 

<span class="c1">// Waiting thread:</span>
<span class="k">if</span> <span class="n">predicate</span> <span class="p">{</span> <span class="k">return</span> <span class="nf">doWork</span><span class="p">()</span> <span class="p">}</span>
<span class="n">nbc</span><span class="o">.</span><span class="nf">preWait</span><span class="p">(</span><span class="n">threadId</span><span class="p">)</span>
<span class="k">if</span> <span class="n">predicate</span> <span class="p">{</span>
  <span class="n">nbc</span><span class="o">.</span><span class="nf">cancelWait</span><span class="p">(</span><span class="n">threadId</span><span class="p">)</span>
  <span class="k">return</span> <span class="nf">doWork</span><span class="p">()</span>
<span class="p">}</span>
<span class="n">nbc</span><span class="o">.</span><span class="nf">commitWait</span><span class="p">(</span><span class="n">threadId</span><span class="p">)</span>  <span class="c1">// Puts current thread to sleep until notified.</span>

<span class="c1">// Notifying thread:</span>
<span class="n">predicate</span> <span class="o">=</span> <span class="kc">true</span>
<span class="n">nbc</span><span class="o">.</span><span class="nf">notify</span><span class="p">()</span>  <span class="c1">// or nbc.notifyAll()</span>
</code></pre>

<p>Notifying is cheap if there are no waiting threads. preWait and commitWait are not cheap, but
they should only be executed if the preceding predicate check failed. This yields an efficient
system in the general case where there is low contention.</p>

                        <a href="Classes/NonblockingCondition.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">final</span> <span class="kd">public</span> <span class="kd">class</span> <span class="kt">NonblockingCondition</span><span class="o">&lt;</span><span class="kt">Environment</span><span class="o">&gt;</span> <span class="k">where</span> <span class="kt">Environment</span> <span class="p">:</span> <span class="kt"><a href="Protocols/ConcurrencyPlatform.html">ConcurrencyPlatform</a></span></code></pre>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">NonblockingCondition</span><span class="p">:</span> <span class="kt">CustomDebugStringConvertible</span></code></pre>

                        </div>
                      </div>
                      <div class="slightly-smaller">
                        <a href="https://github.com/saeta/penguin/tree/master/Sources/PenguinParallel/NonblockingThreadPool/NonblockingCondition.swift#L44-L285">Show on GitHub</a>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </section>

      </article>
    </div>
    <section class="footer">
      <p>&copy; 2020 <a class="link" href="https://github.com/saeta" target="_blank" rel="external">Brennan Saeta <a href="mailto:saeta@google.com">saeta@google.com</a></a>. All rights reserved. (Last updated: 2020-05-31)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.0</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
