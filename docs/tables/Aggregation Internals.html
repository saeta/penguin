<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Aggregation Internals  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>

    <a name="//apple_ref/swift/Section/Aggregation Internals" class="dashAnchor"></a>

    <a title="Aggregation Internals  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          PenguinTables Docs
        </a>
         (31% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/saeta/penguin">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">PenguinTables Reference</a>
      <img class="carat" src="img/carat.png" />
      Aggregation Internals  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Primary%20Types.html">Primary Types</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/PTable.html">PTable</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/PColumn.html">PColumn</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/PTypedColumn.html">PTypedColumn</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Aggregation.html">Aggregation</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/PIndexSet.html">PIndexSet</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/PError.html">PError</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Element%20requirements.html">Element requirements</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Element%20requirements.html#/s:13PenguinTables19ElementRequirementsa">ElementRequirements</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/PDefaultInit.html">PDefaultInit</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/PStringParsible.html">PStringParsible</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/PCSVParsible.html">PCSVParsible</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/DoubleConvertible.html">DoubleConvertible</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Summaries.html">Summaries</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/PColumnSummary.html">PColumnSummary</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/PDataTypeDetails.html">PDataTypeDetails</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/PNumericDetails.html">PNumericDetails</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/PStringDetails.html">PStringDetails</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/PBoolDetails.html">PBoolDetails</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Aggregation%20Internals.html">Aggregation Internals</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="custom-aggregation.html">Custom Aggregation</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/AggregationOperation.html">AggregationOperation</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/AggregationEngine.html">AggregationEngine</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Aggregation%20Internals.html#/s:13PenguinTables25ArbitraryTypedAggregationC">ArbitraryTypedAggregation</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Aggregation%20Internals.html#/s:13PenguinTables28DoubleConvertibleAggregationC">DoubleConvertibleAggregation</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Aggregation%20Internals.html#/s:13PenguinTables18NumericAggregationC">NumericAggregation</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Aggregation%20Internals.html#/s:13PenguinTables17StringAggregationC">StringAggregation</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other%20Guides.html">Other Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="custom-data-types.html">Custom Data Types</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="power-users.html">Power Users</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other%20Extensions.html">Other Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Bool.html">Bool</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Double.html">Double</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Float.html">Float</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Int.html">Int</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Int32.html">Int32</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Int64.html">Int64</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/String.html">String</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other%20Protocols.html">Other Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/PTableSchema.html">PTableSchema</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/PTableSchema.html">PTableSchema</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other%20Structs.html">Other Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/PTypedTable.html">PTypedTable</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/SchemaProblem.html">SchemaProblem</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content top-matter">
            <h1>Aggregation Internals</h1>
            <p>Aggregations allow data to be effectively summarized. The aggregation system in Penguin has been
carefully designed to be type safe and extensible, while supporting efficient operations including
parallelization across multiple cores.</p>

<p>We start with the core operation: recall, aggregation operations execute across the rows of a single
column and compute a result. This behavior is represented by the protocol <code><a href="Protocols/AggregationOperation.html">AggregationOperation</a></code>.
At a high leve, the <code>update(with:)</code> method will be called once for each entry in the column being
aggregated. Once the operation has seen all the data in a given column, <code>finish()</code> is called, which
computes the result.</p>

<p><code><a href="Protocols/AggregationOperation.html">AggregationOperation</a></code> is designed to be fully general, and thus both the <code>Input</code> and <code>Output</code> types
are generic, and represented with <code>associatedtype</code>&lsquo;s. This means you can write an
<code><a href="Protocols/AggregationOperation.html">AggregationOperation</a></code> that takes <code>String</code>s and returns <code>Double</code>&rsquo;s (e.g. computing the average
length of the strings in given column).</p>

<p>In order to support parallelism, the column may be divided into pieces and a separate instance of
the <code><a href="Protocols/AggregationOperation.html">AggregationOperation</a></code> may be initialized. In order to compute a single overall answer, the
<code>merge(with:)</code> method will be called until only a single instance remains, whose <code>finish()</code> method
will be called to compute the final result.</p>

<p><code><a href="Classes/Aggregation.html">Aggregation</a></code> and its subclasses (e.g. <code><a href="Aggregation%20Internals.html#/s:13PenguinTables25ArbitraryTypedAggregationC">ArbitraryTypedAggregation</a></code>, <code>NumericAggreegation</code>,
<code><a href="Aggregation%20Internals.html#/s:13PenguinTables17StringAggregationC">StringAggregation</a></code>, &hellip;) and<code><a href="Classes/AggregationEngine.html">AggregationEngine</a></code>&rsquo;s work together with <code><a href="Structs/PTable.html">PTable</a></code> to efficiently
execute thee aggregation operation.</p>

<p>To learn how to write your own aggregation, check out the
<a href="custom-aggregation.html">Custom Aggregations</a> tutorial.</p>

<!-- TODO: explain more here! -->

          </div>
        </section>

        <section class="section">
          <div class="section-content">
            <div class="task-group">
              <ul class="item-container">
                <li class="item">
                  <div>
                    <code>
                    <a name="/documentation.Custom Aggregation"></a>
                    <a name="//apple_ref/swift/Guide/Custom Aggregation" class="dashAnchor"></a>
                    <a class="direct-link" href="custom-aggregation.html">Custom Aggregation</a>
                    </code>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:13PenguinTables20AggregationOperationP"></a>
                    <a name="//apple_ref/swift/Protocol/AggregationOperation" class="dashAnchor"></a>
                    <a class="token" href="#/s:13PenguinTables20AggregationOperationP">AggregationOperation</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>AggregationOperation&rsquo;s represent the per-group operations within a
&ldquo;split-apply-combine&rdquo; analysis. Types conforming to the
<code>AggregationOperation</code> protocol can be used as aggregation functions within
a &ldquo;groupBy&rdquo; operation.</p>

<p>Because <code>AggregationOperation</code>s can be parallelized across multiple cores or
hosts, they must support a &ldquo;merge&rdquo; operation, which can be used to
aggregate the state within the operations themselves.</p>

                        <a href="Protocols/AggregationOperation.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">protocol</span> <span class="kt">AggregationOperation</span></code></pre>

                        </div>
                      </div>
                      <div class="slightly-smaller">
                        <a href="https://github.com/saeta/penguin/tree/main/Sources/PenguinTables/GroupBy.swift#L143-L159">Show on GitHub</a>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:13PenguinTables17AggregationEngineC"></a>
                    <a name="//apple_ref/swift/Class/AggregationEngine" class="dashAnchor"></a>
                    <a class="token" href="#/s:13PenguinTables17AggregationEngineC">AggregationEngine</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Undocumented</p>

                        <a href="Classes/AggregationEngine.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">class</span> <span class="kt">AggregationEngine</span></code></pre>

                        </div>
                      </div>
                      <div class="slightly-smaller">
                        <a href="https://github.com/saeta/penguin/tree/main/Sources/PenguinTables/GroupBy.swift#L78-L90">Show on GitHub</a>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:13PenguinTables25ArbitraryTypedAggregationC"></a>
                    <a name="//apple_ref/swift/Class/ArbitraryTypedAggregation" class="dashAnchor"></a>
                    <a class="token" href="#/s:13PenguinTables25ArbitraryTypedAggregationC">ArbitraryTypedAggregation</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Undocumented</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">class</span> <span class="kt">ArbitraryTypedAggregation</span> <span class="p">:</span> <span class="kt"><a href="Classes/Aggregation.html">Aggregation</a></span></code></pre>

                        </div>
                      </div>
                      <div class="slightly-smaller">
                        <a href="https://github.com/saeta/penguin/tree/main/Sources/PenguinTables/GroupBy.swift#L52-L60">Show on GitHub</a>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:13PenguinTables28DoubleConvertibleAggregationC"></a>
                    <a name="//apple_ref/swift/Class/DoubleConvertibleAggregation" class="dashAnchor"></a>
                    <a class="token" href="#/s:13PenguinTables28DoubleConvertibleAggregationC">DoubleConvertibleAggregation</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Undocumented</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">class</span> <span class="kt">DoubleConvertibleAggregation</span> <span class="p">:</span> <span class="kt"><a href="Classes/Aggregation.html">Aggregation</a></span></code></pre>

                        </div>
                      </div>
                      <div class="slightly-smaller">
                        <a href="https://github.com/saeta/penguin/tree/main/Sources/PenguinTables/GroupBy.swift#L40-L50">Show on GitHub</a>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:13PenguinTables18NumericAggregationC"></a>
                    <a name="//apple_ref/swift/Class/NumericAggregation" class="dashAnchor"></a>
                    <a class="token" href="#/s:13PenguinTables18NumericAggregationC">NumericAggregation</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Undocumented</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">class</span> <span class="kt">NumericAggregation</span> <span class="p">:</span> <span class="kt"><a href="Classes/Aggregation.html">Aggregation</a></span></code></pre>

                        </div>
                      </div>
                      <div class="slightly-smaller">
                        <a href="https://github.com/saeta/penguin/tree/main/Sources/PenguinTables/GroupBy.swift#L30-L38">Show on GitHub</a>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:13PenguinTables17StringAggregationC"></a>
                    <a name="//apple_ref/swift/Class/StringAggregation" class="dashAnchor"></a>
                    <a class="token" href="#/s:13PenguinTables17StringAggregationC">StringAggregation</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Undocumented</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">class</span> <span class="kt">StringAggregation</span><span class="o">&lt;</span><span class="kt">Op</span><span class="o">&gt;</span> <span class="p">:</span> <span class="kt"><a href="Classes/Aggregation.html">Aggregation</a></span> <span class="k">where</span> <span class="kt">Op</span> <span class="p">:</span> <span class="kt"><a href="Protocols/AggregationOperation.html">AggregationOperation</a></span><span class="p">,</span> <span class="kt">Op</span><span class="o">.</span><span class="kt">Input</span> <span class="o">==</span> <span class="kt">String</span></code></pre>

                        </div>
                      </div>
                      <div class="slightly-smaller">
                        <a href="https://github.com/saeta/penguin/tree/main/Sources/PenguinTables/GroupBy.swift#L62-L76">Show on GitHub</a>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </section>

      </article>
    </div>
    <section class="footer">
      <p>&copy; 2020 <a class="link" href="https://github.com/saeta" target="_blank" rel="external">Brennan Saeta <a href="mailto:saeta@google.com">saeta@google.com</a></a>. All rights reserved. (Last updated: 2020-12-07)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.6</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
